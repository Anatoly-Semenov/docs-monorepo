# 1. Документооборот
Документооборот осуществляется в 3 этапа:
## 1) Отправка данных о документе
Отправка документа в сервис подписания осуществляется через POST-запрос
на `/V1/diadoc/`. Ниже представлен curl запроса в качестве примера:
```
curl --location 'http://localhost:60030/V1/diadoc/' \
--header 'Content-Type: application/json' \
--data '{
    "doc_id": "91a0fff3-0f84-4695-9a8a-424036bdf713",
    "reg_number": "ДС-2/ 51588",
    "reg_date": "2023-04-18",
    "name": "СЗ_ГОРОДОК_ЕЭСК_ДС-2_ДОГ-51588_СибТракт_Тех.присоединение",
    "document_kind": "Договор",
    "sum": 150000.00,
    "is_internal": false,
    "is_cancelled": false,
    "need_recipient_signature": false,
    "comment": "Договор",
    "link_contr_system": "http://yandex1.ru",
    "org_id": "4f7f23d0-dac3-11ee-bfce-0050560b6a3c",
    "kontragent": [
        "9646931586"
    ],
    "docs_id": [
        "b07be130-7136-415a-8885-8bdcc8dd46c8",
        "8f165246-b0cd-4457-87ac-342c177f8ea4"
    ]
}' 
```

## 2) Загрузка файлов
Для загрузки файлов в сервис подписания используется POST-запрос на `V1/diadoc/upload/:doc_id`. Ниже представлен curl запроса в качестве примера:
```
curl --location 'http://localhost:60030/V1/diadoc/upload/91a0fff3-0f84-4695-9a8a-424036bdf713' \
--form 'file=@"/C:/Users/user/Desktop/sign/Тестовые документы/test1.txt"' \
--form 'name_files="Document1.docx"' \
--form 'kind_files="Договор"' \
--form 'type_files="true"' \
--form 'file_id="f01e2e02-5411-459b-899c-50b466fb2af7"'
```

## 3) Отправка документа в Диадок
Отправка документа в Диадок (публикация) осуществляется с использованием PUT-запроса на `V1/diadoc/upload/:doc_id/publish`. Ниже представлен curl запроса в качестве примера:
```
curl --location --request PUT 'http://localhost:60030/V1/diadoc/upload/91a0fff3-0f84-4695-9a8a-424036bdf713/publish' \
```

# 2. Процесс подписания
Для дальнейшего продвижения по процессу документооборота необходимо выполнить подписание документа (файлов). При наличии соответствующих доступов, сделать это можно перейдя по ссылка из таблицы files столбца link_diadoc и выполнив подписание в графическом интерфейсе.
В зависимости от типа документа, может потребоваться подписание со второй стороны, выполнить его можно перейдя в соответствующую организацию и подписав входящие документы (файлы).

# 3. Обновление статусов
Cron-задача выполняет периодический опрос Диадока по организациям и фиксирует обновления статусов. Обновлённые статусы отправляются в kafka.

# 4. Получение печатных форм и архивов
При получении финального статуса по всем файлам документа начинается процесс формирования и загрузки печатных форм и архивов из Диадок. После успешной загрузки соответствующий статус будет направлен в kafka.

Для загрузки печатных форм и архивов из сервиса подписания следует использовать GET-запрос `V1/diadoc/:id/:filetype`, где id - идентификатор от смежных систем, filetype - одно из значений: archive, print_form.

Пример curl запроса для загрузки файла предоставлен ниже:
```
curl --location 'http://localhost:60030/V1/diadoc/f14e2e02-5411-459b-899c-50b466fb2af7/print_form' \
```
